3. Eventos

Los eventos son una forma de comunicar entre componentes hijos y componentes padres. Vamos a utilizar los eventos para comunicar cambios desde un componente hijo a su componente padre.

Anteriormente indicabamos que cuando utilizabamos props, el flujo de datos era unidireccipnal desde el componente padra hacia el componente hijo.

Eso quiere decir, que si modificabamos la propiedad del componente padre, esto se veia reflejado en todos los componentes hijos, pero no podiamos modificar el prop desde el componente hijo.

Pero si necesitabamos que desde el componente hijo modificabamos la propiedad del componente padre.

Se puede, utilizando eventos.

Para ello 

En el componente padre, dond elo estamos llamando:

<DetailCourse v-for="course in courses" :course :prueba disabled />


Eliminamos la propiedad disabled.

y en el componente hijo en el boton,

<button >Haz click</button>

Ydentro de los props eliminamos

Quitamos:

,
  disabled: Boolean,

Otra cosa es que el prop que queremos recibir, ya no sera prueba sino sera, count  

dejando:

const props = defineProps({
  course: Object,

  count: {
    type: Number,
    default: 0,
  },
})

Cambiamos donde se hacia referencia

<h1>{{ course.title }} ({{ count }})</h1>


En el compoente principal 


en el atributo dinamico:

const count = ref(5)



<DetailCourse v-for="course in courses" :course :count />


por ultimo el input que se estaba enlazando tambien 

<input type="text" v-model="count" />


conesto en el componente padre

<script setup>
//1. Importamos ref
import { ref } from 'vue'

// 2. Importar el componente Detail course
import DetailCourse from './components/DetailCourse.vue'

let courses = [
  {
    title: 'Vue desde cero',
    professor: 'Klvst3r',
    price: 10,
  },
  {
    title: 'Angular desde cero',
    professor: 'Klvst3r',
    price: 15,
  },
  {
    title: 'React desde cero',
    professor: 'Klvst3r',
    price: 20,
  },
]

//Pasamos el atributo de manera dinamica:
const count = ref(5)
</script>

<template>
  <input type="text" v-model="count" />

  <DetailCourse v-for="course in courses" :course :count />
</template>
<!-- h1 { color: #35495e; } -->
<style scoped></style>


y el comopnente ijo

<script setup>
const props = defineProps({
  course: Object,

  count: {
    type: Number,
    default: 0,
  },
})

//console.log(course)
//prueba = 'Hola mundo desde el componente hijo'
</script>

<template>
  <h1>{{ course.title }} ({{ count }})</h1>
  <p>
    {{ course.professor }}
  </p>
  <p>{{ course.price }}</p>

  <button>Haz click</button>
</template>

<style scoped></style>



todo sigue funcionando igual



<input type="text" v-model.number="count" />


Para transformar el valor en un valor numerico.



Lo que se prentende es que cada vez que se haga click sobre el boton, se modifique, el valor, lo disminuya en uno.

Para ello se trabajara con eventos.

Para ello en el componente hijo en el boton

Al hacer click se ejecutara un evento.


Podriamos pedir que escuchemos el evento click y emitirun evento personalizado 

<button @click="">Haz click</button>

Debemos llamar al metodo integrado emit, dentro del metodo integrad abrimos paretesis y darle un nombre a nuestro evento.

<button @click="$emit('decrementCount')">Haz click</button>


ahora debe haber algo que lo este escuchando.

Para que al hacer click disminuyta en uno.

Entonces para escuchar el evento, nos vamos al componente padre y donde se llama el componente escuchamos el evento de la siguiente manera:



  <DetailCourse 
    v-for="course in courses" 
    :course :count 
    @decrementCount="count--"
    />


Disminuyendo en 1 la propiedad count    


De esta manera que desde el componente hijo, modificamos una propiedad del compoente padre.


con esto disminuye en uno nuestro valor de lo que tengamos en el input.

Por que todos se estan vien reflejando por que el cambio se esta haciendo desde el componente padre, por ello desd ahi modific el evento, por consecuencia, se refleja cn todos los componentes hijos que se esten utilizando.

Vue permite escuchar los eventos, que hacen referencia, al nombre del evento.

decrementCount

Podemos utilizar una sentencia, que es la siguiente.


@decrement-count="count--"

vue hace la transformacioin automatica del camel Case a un formato keuel, parlabras separadas por guienes..


Que tal si nosotros, a la hora de emitir un evento queremos pasarle un parametro, por eemplo queremos pasarle la cantidad, con la cual quiero que disminue, por ejemplo de 2 n 2.

Para elo nos dirigimos a la hora de escuchar tenemos que escucharlo de la siguiente manera.


con un afuncion flecha


dentro de los parentesis recibimos el parametro por ejemplo

2

del 


<button @click="$emit('decrementCount', 2)">Haz click</button>


Puede ser el valor de n

@decrement-count="(n) =>"

Una vez recibido, lo proximo es querer modificar el valor de count disminuyendo en el valor recibido.


@decrement-count="(n) => (count -= n)"

Logrando, capturar el valor para diminuirlo en esa cantidad.

Ahora podemos derivarla en otra operaci√≥n con una funcion

 

 count es un objeto reactivo

function decrementCount(n) {
  count.value -= n
}
</script>

Recibe el parametro la funicon, y ahora acedemos a count que es un objetoractivo a su objeto value, y lo disminuya en n cantidad


En el template padre pegar


@decrement-count="decrementCount"

Ahora debe fucnionar igual


Actualmente se ha emitido el evento directamente en el boton


<button @click="$emit('decrementCount', 2)">Haz click</button>

En el template, estamos pidiendo que casa vez que hagamos click se emita el evetno, pero puede ocurrir que cada vez que ocurre el evento no desde el template.


Lo que queremos que ocurra ahora es que alhacer click, se ejecute una fucnion que se llame buttonClick

<button @click="buttonClick">Haz click</button>

Esta funcion no existe aun, en el componente padre, la definimos en la parte del script

function buttonClick(){
  
}

Emitir desde aca el evento, anteriormente se emitia el evento al llamar al evento con un emit(parametro de decremento, valor)

le pasabamos un parametro,

ahora si hacemos click, no pasa nada. Por qu no se genera la funcion emit

function buttonClick(){
  $emit('decrement-count', 2)
}

Pero esto solo se puede definir en el template y no en el script, entonces, si es que queremos emitir un evento desde el script se debe hacer de la siguiente manera.

definiendo primero en el componente hijo un aconstante llamada emit
es la constante a tuilizar paa llamar, al metodo defineEmits(paramtero), pero luego de eso debemos llamar al siguiente menoto defineEmits

Dentro vamos a especificar los eventos que queremos emitir

ahora solo tenemos uno 



const emit = defineEmits(['decremetnCount']);

Ahora solo vamos a hacer referencia a la constante emit, seguido del nombre de los eventos declarados a utilizar, decremento count con el valor de 2

en la funcion solo hacemos referencia al valor de la constante 

function buttonClick() {
  emit('decrementCount', 2)
}


y ya debe funcionar, si parece complicado se puede emitir directamente desde el boton.


Emitir un eventos desde, cada vez que se guarde un registro en la bd, o una compra en el carrito de compras, se querra emitir desde aca.

Dese el Script.

Y se debe hacer asi.

